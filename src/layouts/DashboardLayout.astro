---
import MainLayout from '@/layouts/MainLayout.astro';
import { MobileNav } from '@/components/navbar/MobileNav';
import { UserAvatarMenu } from '@/components/navbar/UserAvatarMenu';
import { Folder, Heart, LayoutGrid } from 'lucide-react';
import { NAV_LINKS } from '@/components/navbar/nav-links';

interface Props {
  title?: string;
}

const { title = 'Dashboard â€” 10x Facts' } = Astro.props;

const pathname = Astro.url.pathname;
const isActive = (href: string) =>
  pathname === href || (href !== '/' && pathname.startsWith(`${href}/`));

const iconMap = {
  dashboard: LayoutGrid,
  collections: Folder,
  favorites: Heart,
} as const;
---

<MainLayout title={title}>
  <div class="relative min-h-screen bg-background text-foreground">
    <div
      class="pointer-events-none absolute inset-0 -z-10 bg-[radial-gradient(1200px_circle_at_20%_-10%,color-mix(in_oklch,var(--primary)_18%,transparent),transparent_55%),radial-gradient(900px_circle_at_80%_0%,color-mix(in_oklch,var(--primary)_12%,transparent),transparent_60%)]"
    >
    </div>

    <header
      class="sticky top-0 z-40 border-b bg-background/70 backdrop-blur supports-[backdrop-filter]:bg-background/60"
    >
      <div
        class="mx-auto flex max-w-6xl items-center justify-between gap-4 px-4 py-3"
      >
        <a
          href="/dashboard"
          class="flex items-center gap-2"
        >
          <span
            class="inline-flex size-7 items-center justify-center rounded-xl bg-gradient-to-br from-primary to-primary/60 shadow-sm ring-1 ring-primary/20"
            aria-hidden="true"
          >
            <span class="text-sm font-bold text-primary-foreground">10x</span>
          </span>
          <span class="text-base font-semibold tracking-tight">Facts</span>
        </a>
        <div class="flex items-center gap-4">
          <MobileNav
            client:load
            pathname={pathname}
          />
          <nav class="hidden items-center gap-1 text-sm md:flex">
            {
              NAV_LINKS.map(({ id, href, label }) => {
                const Icon = iconMap[id];
                return (
                  <a
                    href={href}
                    class:list={[
                      'inline-flex items-center gap-2 rounded-full px-3 py-1.5 transition-colors',
                      isActive(href)
                        ? 'bg-primary/10 text-foreground ring-1 ring-primary/20'
                        : 'text-muted-foreground hover:bg-accent/50 hover:text-foreground',
                    ]}
                  >
                    <Icon
                      className="size-4"
                      aria-hidden="true"
                    />
                    {label}
                  </a>
                );
              })
            }
          </nav>
          <UserAvatarMenu client:load />
        </div>
      </div>
    </header>

    <div class="mx-auto max-w-6xl">
      <slot />
    </div>
  </div>
</MainLayout>
